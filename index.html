<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Liste des gares</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.5/css/bulma.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">
    <meta name="theme-color" content="#00d182"> <!-- couleur de la barre d'url-->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.ico">
    <!-- Safari uniquement : personnalise la barre de statut des liens -->
    <meta name="apple-mobile-web-app-status-bar-style" content="blue">
    <meta name="apple-mobile-web-app-capable" content="fullscreen">
    <link rel="apple-touch-startup-image" href="android-icon-36x36.png">
    <link rel="apple-touch-icon" href="./android-icon-192x192.png">
</head>
<body>
        <div class="modal">
                <div class="modal-background"></div>
                <div class="modal-content">
                        <article class="message is-dark">
                                <div class="message-header">
                                  <p>Erreur</p>
                                </div>
                                <div class="message-body">
                                  Pas de trains programmés
                                </div>
                              </article>
                </div>
                <button class="modal-close is-large" aria-label="close"></button>
              </div>
    <header class="hero is-primary">
        <div class="hero-body">
          <div class="container">
              <img src="android-icon-96x96.png" alt="logo">
            <h1 class="title">
             Trains au départ
            </h1>
            <h2 class="subtitle">
              Trains à l'heure ?
            </h2>
          </div>
          <nav class="navbar is-primary">
            <ul class="navbar-brand container">
              <li><a href="index.html" class="navbar-item is-active">Home</a></li>
              <li><a href="about.html" class="navbar-item">About</a></li>
            </ul>
          </nav>
        </div>
        <a class="button is-danger install hidden">Installer</a>
    </header>
    <main class="container">
        <ul class="gares">
          <!-- A dynamiser -->
          <li class="card" data-id="id_gare">
                                        <header class="card-header">
                                            <h2 class="card-header-title">Charleroi</h2>
                                            <a href="#" class="card-header-icon" aria-label="more options">
                                                    <span class="icon">
                                                    <i class="fas fa-angle-down" aria-hidden="true"></i>
                                                    </span>
                                                </a>
                                        </header>
                                            <div class="card-content">
                                                <div class="content">
                                                   <table class="trains table is-striped">
                                                     <tr>
                                                       <th>Destination</th>
                                                       <th>Départ</th>
                                                       <th>Quai</th>
                                                       <th>Retard</th>
                                                     </tr>
                                                     <tr>
                                                       <td>Namur</td>
                                                       <td>20:00</td>
                                                       <td>1</td>
                                                       <td>10 mins.</td>
                                                     </tr>
                                                     <tr>
                                                       <td>Bruxelles</td>
                                                       <td>20:12</td>
                                                       <td>2</td>
                                                       <td>0 mins.</td>
                                                     </tr>
                                                   </table>
                                                </div>
                                        </div>
                                    </li>
          <!-- end dynamique -->
    </ul>
    </main>
      <footer class="footer">
        <div class="content has-text-centered">
          <p>
            <strong>SNCB</strong> by <a href="https://sncb.be">Piere Charlier</a>.
          </p>
        </div>
      </footer>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
      <script src="main.js"></script>
      <script>
        // On fait un test pour vérifier que le navigateur gère le principe du service worker
        if('serviceWorker' in navigator) {
          //est-ce que cette méthode existe dans le navigateur
          //nb: navigator contient window par exemple, ou document
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('service-worker.js')
            // au chargement de la fenetre, on enregistre service-worker.js dans serviceWorker
            // c'est plutot lent et ça renvoie une promise :
            .then((reg) => {
              console.log('Notify', 'service worker is started @ scope ' + reg.scope)
            })
            .catch((e) => {console.log('alert','Service worker registration failed with ' + e)})
          })
        }

// afficher le btn d'installation custom
const installBtn = document.querySelector('.install')
let deferredPrompt; // on déclare une propriété vide qui est GLOBALE pour qu'on puisse la nourrir dans un eventListener scopé
//on ajoute un écouteur d'évènement sur la window en entier
window.addEventListener('beforeinstallprompt', ev => {
  ev.preventDefault() //désactive le bouton d'installation SUR NAVIGATEUR MOBILE, pas dans chrome browser
  deferredPrompt = ev
  // on stock l'évènement de window dans deferredPrompt
  installBtn.classList.remove('hidden')
})

installBtn.addEventListener('click', ev => {
  installBtn.classList.add('hidden')
  deferredPrompt.prompt() // on déclenche l'évènement qu'on avait prevent dans le eventListenner. On prend la main
  deferredPrompt.userChoice.then(choice => {
    // on ajoute une promesse sur l'userchoice de deferredprompt
    if (choice === 'accepted') { //si l'utilisateur accepte l'installation
      console.log("Installation acceptée")
    } else {
      console.log("Installation refusée")
    }
    defferedPrompt = null
  })
  

})

      </script>
</body>
</html>